---
title: Operating System -Chapter 5
commentable: true
date: 2023-02-17
modified: true
Edit: 2023-02-17
mathjax: true
mermaid: true
tags: Operating-System notes
categories: study notes
description: 操作系统学习笔记：设备管理
---

# I/O控制方式

## 程序控制I/O

- 完成一次读写：
    - CPU向控制器发出命令
    - 读入I/O状态，不断循环直到I/O完成
    - 将I/O中的数据读入CPU寄存器
    - 将CPU寄存器写入主存中

<img src="https://raw.githubusercontent.com/adoptedirelia/adoptedirelia.github.io/main/_posts/2023-02-16-OS/pic8.png" width="30%"> 

- CPU干预频率：很频繁，在等待I/O完成过程中需要不断轮询检查

- 数据传送的单位：Byte

- 数据流向：
    - 读：I/O设备->CPU->内存
    - 写：内存->CPU->I/O设备

- 优劣：
    - 优点：实现简单，可以用软件的方式实现
    - 缺点：CPU和I/O串行工作，CPU利用率低，需要长期“忙等”

## 中断驱动方式

- 完成一次读写：
    - CPU向控制器发出命令
    - 读入I/O状态，阻塞该进程，直到I/O完成发出中断信号
    - 将I/O中的数据读入CPU寄存器
    - 将CPU寄存器写入主存中

<img src="https://raw.githubusercontent.com/adoptedirelia/adoptedirelia.github.io/main/_posts/2023-02-16-OS/pic9.png" width="30%"> 

- CPU干预频率：在I/O开始之前和完成之后需要CPU介入，等待I/O的时候可运行别的进程

- 数据传送单位：Byte

- 数据流向：
    - 读：I/O设备->CPU->内存
    - 写：内存->CPU->I/O设备

- 优劣:
    - 优点：解决了程序直接控制的最大的缺点，CPU不需要不停轮询，CPU利用率得到明显提升
    - 缺点：频繁的中断处理会消耗较多的CPU时间

## DMA方式

- 完成一次读写:
    - CPU给DMA发出命令，给出相应参数，然后CPU做自己的事情
    - DMA读完/写完数据给CPU发出中断信号

- CPU干预频率：传送一个或者多个数据块的开始或者结束的时候，CPU才进行干预

- 数据传送单位：一个/多个块

- 数据流向：
    - 读：I/O->内存
    - 写：内存->I/O

- 优劣：
    - 优点：CPU介入频率下降，数据传输增多
    - 缺点：只能读写连续的块，无法离散进行

## 通道控制方式

通道可以识别并且执行一系列通道命令，可以理解为小型CPU。

- 完成一次读写：
    - CPU向通道发出I/O指令，指明通道程序的位置以及需要操作的I/O设备，之后CPU切换到其他进程执行
    - 通道执行内存中的通道程序
    - 通道执行规定的任务后，向CPU发出中断信号


<img src="https://raw.githubusercontent.com/adoptedirelia/adoptedirelia.github.io/main/_posts/2023-02-16-OS/pic10.png" width="70%"> 


- CPU干预频率：极低，完成一组数据块的读写后才需要CPU干预

- 数据传送单位：一组数据块

- 数据流向：
    - 读：I/O->内存
    - 写：内存->I/O
- 优劣：
    - 优点：资源利用率高
    - 缺点：实现复杂


# 缓冲

## 作用

- 缓解CPU和I/O设备之间速度不匹配的矛盾
- 减少CPU的中断频率
- 解决数据粒度不匹配的问题
- 提高CPU和I/O设备之间的并行性

## 单缓冲

当用户进程请求某种块设备读入若干块的数据，若采用单缓冲的策略，系统就会在主存中为其分配一个缓冲区

> *缓冲区不空的时候不能向缓冲区传入数据，只能从缓冲区把数据传出；缓冲区空的时候可以向缓冲区传入数据，但是必须缓冲区充满之后才能传出数据*

记 T(传入缓冲区时间),M(传入用户区时间)，C(CPU处理时间)

处理一块平均耗时 max(C,T) + M

## 双缓冲

内存中设置了两个缓冲区

## 缓冲池

<img src="https://raw.githubusercontent.com/adoptedirelia/adoptedirelia.github.io/main/_posts/2023-02-16-OS/pic11.png" width="70%"> 

- 输入：从空缓冲队列提取一块数据，放到hin中，然后放到输入队列，然后用户从输入队列中取得对应的数据，提取给用户进程

- 输出：用户从空缓冲队列提取一块数据放到hout,然后放到放到输出队列，然后从输出队列中取得对应的数据

# 磁盘

磁盘的盘面被可以被分为一个个磁道（圆环），同时也可以分成一个个扇区（扇面），不同的磁盘可以组成柱面.

可以标记为(柱面号，盘面号，扇区号)->读取地址连续的磁盘块的时候可以减少磁盘移动的时间



## 磁盘调度算法

### 先来先服务(FCFS)

- 优劣：
    - 优点：若请求访问的磁道比较集中，则算法性能良好
    - 缺点：若请求访问的磁道不集中，则算法性能较差

### 最短寻找时间(SSTF)

- 思想：每次处理与磁头相距最近的磁道。

- 优劣：
    - 优点：平均寻道时间最短
    - 缺点：可能导致饥饿

### 扫描算法

- 思想：只有移动到最外面才能往内移动，只有移动到最内侧才能往外移动

- 优劣：
    - 优点：不会饥饿
    - 缺点：响应频率不均匀；只有在最边缘才能改变方向

### LOOK调度算法

- 思想：若当前移动方向上已经没有别的请求，就可以立刻改变磁头移动方向

### C-SCAN算法

- 思想：磁头返回的时候直接返回到起始端

### C-LOOK算法

- 思想：立刻返回到请求的磁道

